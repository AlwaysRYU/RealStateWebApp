<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
	<!-- Bootstrap 5 ë²„ì „ -->
	<!-- https://getbootstrap.com/docs/5.0/getting-started/introduction/ -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
	
	<!-- No jQuery -->

	<script src="//cdn.jsdelivr.net/npm/alertifyjs@1.12.0/build/alertify.min.js"></script>
	<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.12.0/build/css/alertify.min.css"/>
	<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.12.0/build/css/themes/default.min.css"/>
	
	<!-- New for FileUpload, CKEditor -->
	<link rel="stylesheet" href="/css/common.css">
	<script src="https://cdn.ckeditor.com/ckeditor5/19.0.0/classic/ckeditor.js"></script>
	<!-- / New for FileUpload, CKEditor -->
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
		<div class="container-fluid">
			<a class="navbar-brand" href="/index_AfterLogin">Happy
				House</a>
			<button class="navbar-toggler" type="button"
				data-bs-toggle="collapse" data-bs-target="#navbarNav"
				aria-controls="navbarNav" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav">
					<li class="nav-item"><a class="nav-link active"
						aria-current="page" href="/noticelist">ê³µì§€ì‚¬í•­</a></li>
					<li class="nav-item"><a class="nav-link" href="/board">ê²Œì‹œíŒ</a></li>
					<li class="nav-item"><a class="nav-link" href="/Building_Search"> ì•„íŒŒíŠ¸ ë§¤ë§¤ ì •ë³´</a></li>
					
					
				</ul>
			</div>
			<div class="collapse navbar-collapse justify-content-end"
				id="navbarNav">
				<ul class="navbar-nav">
					<li class="nav-item"><a class="nav-link" id="logout">ğŸ”’ë¡œê·¸ì•„ì›ƒ</a>
					</li>
					<li class="nav-item"><a class="nav-link" id="mypage">âœ‹ë‚´ì •ë³´</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
<br>

<br>
<div class="container">

  	<h4 class="text-center mb-3">ê²Œì‹œíŒ - Main</h4>       
  
	<div class="input-group mb-3">
	  <input id="inputSearchWord" type="text" class="form-control" placeholder="Search">
	  <button id="btnSearchWord" class="btn btn-success" type="button">Search</button>
	</div>
	
	<table class="table table-hover">
		<thead>
       		<tr>
				<th>#</th>
				<th>ì œëª©</th>
				<th>ì‘ì„±ì</th>
				<th>ì‘ì„±ì¼ì‹œ</th>
				<th>ì¡°íšŒìˆ˜</th>
			</tr>
     	</thead>
     	<tbody id="boardTbody">
     	</tbody>
   	</table>
   
	<div id="paginationWrapper"></div>

	<button class="btn btn-sm btn-primary" id="btnInsert">ê¸€ì“°ê¸°</button>
</div>

<!-- modal begin ------------------------------------------------------------------------->
<!-- Modal insert-->
<div class="modal" id="boardInsertModal">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<!-- Modal Header -->
	      	<div class="modal-header">
	        	<h4 class="modal-title">ê¸€ì“°ê¸°</h4>
	        	<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      	</div>
			<div class="modal-body">
			
				<div class="mb-3">
				  <label for="titleInsert" class="form-label">ì œëª©</label>
				  <input type="text" class="form-control" id="titleInsert">
				</div>
				<div class="mb-3">
				  <label for="contentInsert" class="form-label">ë‚´ìš©</label>
				  
				  <!-- New for FileUpload, CKEditor -->
						    <div id=divEditorInsert></div>
				  <!-- / New for FileUpload, CKEditor -->
				</div>
				 
				<div class="mb-3">
					<div class="form-check">
					  <input class="form-check-input" type="checkbox" value="" id="chkFileUploadInsert">
					  <label class="form-check-label" for="chkFileUploadInsert">íŒŒì¼ ì¶”ê°€</label>
					</div>
				</div>
				<div class="mb-3" style="display:none;" id="imgFileUploadInsertWrapper">
					<input type="file" id="inputFileUploadInsert" multiple>
					<div id="imgFileUploadInsertThumbnail" class="thumbnail-wrapper"></div>
				</div>
				<button id="btnBoardInsert" class="btn btn-sm btn-primary btn-outline float-end" data-bs-dismiss="modal" type="button">ë“±ë¡</button>
			</div>
		</div>
	</div>
</div>
<!-- End Modal -->

<!-- Modal detail-->
<div class="modal fade" id="boardDetailModal">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<!-- Modal Header -->
	      	<div class="modal-header">
	        	<h4 class="modal-title">ê¸€ ìƒì„¸</h4>
	        	<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      	</div>
	      	
			<div class="modal-body">
			
                <div class="example table-responsive">
                    <table class="table">
                      <tbody>
                        <tr><td>ê¸€ë²ˆí˜¸</td><td id="boardIdDetail">#</td></tr>
                        <tr><td>ì œëª©</td><td id="titleDetail">#</td></tr>
                        <tr><td>ë‚´ìš©</td><td id="contentDetail">#</td></tr>
                        <tr><td>ì‘ì„±ì</td><td id="userNameDetail">#</td></tr>
                        <tr><td>ì‘ì„±ì¼ì‹œ</td><td id="regDtDetail">#</td></tr>
                        <tr><td>ì¡°íšŒìˆ˜</td><td id="readCountDetail">#</td></tr>
                         
                        <!-- New for FileUpload -->
                         
                        <tr><td colspan="2">ì²¨ë¶€íŒŒì¼</td></tr>
                        <tr><td colspan="2" id="fileListDetail">#</td></tr>
                        
                        <!-- / New for FileUpload -->

                      </tbody>
                    </table>
             	</div>
				<button id="btnBoardUpdateForm" class="btn btn-sm btn-primary btn-outline" data-bs-dismiss="modal" type="button">ê¸€ ìˆ˜ì •í•˜ê¸°</button>
				<button id="btnBoardDeleteConfirm" class="btn btn-sm btn-warning btn-outline" data-bs-dismiss="modal" type="button">ê¸€ ì‚­ì œí•˜ê¸°</button>

			</div>
		</div>
	</div>
</div>
<!-- End Modal -->

<!-- Modal update-->
<div class="modal fade" id="boardUpdateModal">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<!-- Modal Header -->
	      	<div class="modal-header">
	        	<h4 class="modal-title">ê¸€ìˆ˜ì •</h4>
	        	<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      	</div>
			<div class="modal-body">

				<div class="mb-3">
				  <label for="titleUpdate" class="form-label">ì œëª©</label>
				  <input type="text" class="form-control" id="titleUpdate">
				</div>
				<div class="mb-3">
					<!-- New for FileUpload, CKEditor -->
						 <div id=divEditorUpdate></div>
					<!-- New for FileUpload -->
				 </div>
				 
				<div class="mb-3">
					ì²¨ë¶€íŒŒì¼ : <span id="fileListUpdate"></span>
				</div>
				
				<div class="mb-3">
					<div class="form-check">
					  <input class="form-check-input" type="checkbox" value="" id="chkFileUploadUpdate">
					  <label class="form-check-label" for="chkFileUploadUpdate">íŒŒì¼ ë³€ê²½</label>
					</div>
				</div>
				<div class="mb-3" style="display:none;" id="imgFileUploadUpdateWrapper">
					<input type="file" id="inputFileUploadUpdate" multiple>
					<div id="imgFileUploadUpdateThumbnail" class="thumbnail-wrapper"></div>
				</div>
				
				<button id="btnBoardUpdate" class="btn btn-sm btn-primary btn-outline float-end" data-bs-dismiss="modal" type="button">ìˆ˜ì •</button>

			</div>
		</div>
	</div>
</div>
<!-- End Modal -->
<!-- modal end --------------------------------------------------------------------------->
<!--------------- Modal --------------------------->
		<div class="modal fade" id="userinfo">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<!-- Modal Header -->
					<div class="modal-header">
						<h4 class="modal-title">ë‚´ì •ë³´ ë³´ê¸°</h4>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>

					<div class="modal-body">

						<div class="example table-responsive">
							<table class="table">
								<tbody>
									
									<tr>
										<td> ìœ ì € ì´ë¦„ </td>
										<td id="userNameDetail">#</td>
									</tr>
									<tr>
										<td> ìœ ì € ì´ë©”ì¼ </td>
										<td id="userEmailDetail">#</td>
									</tr>
									<tr>
										<td> ê°€ì…ë‚ ì§œ </td>
										<td id="userRegiDetail">#</td>
									</tr>
																		
								</tbody>
							</table>
						</div>
						
						<div class="container">
						  <div class="row">
						    <div class="col-9">
						    </div>
						    <div class="col-3">
						     <button id="modify" type="button" class="btn btn-warning">íšŒì›ì •ë³´ ìˆ˜ì •í•˜ê¸°</button>
						   
						    </div>
						  </div>
						</div>

					</div>
					
					
					
				</div>
			</div>
		</div>
		<!--------------- Modal --------------------------->
<script src="/js/util.js"></script>		
<script>

	var LIST_ROW_COUNT = 10;	//limit
	var OFFSET = 0;
	var SEARCH_WORD = "";
	
	
	var CKEditorInsert;
	var CKEditorUpdate;
	
	
	var PAGE_LINK_COUNT = 10;	// pagination link ê°¯ìˆ˜
	var TOTAL_LIST_ITEM_COUNT = 0;
	var CURRENT_PAGE_INDEX = 1;
	
	
	const SUCCESS = 1;
	
	window.onload = function(){
		
		document.querySelector("#logout").onclick = function(){
			alert("ë¡œê·¸ì•„ì›ƒí•©ë‹ˆë‹¤!");
			sessionStorage.clear();
			window.location.href="/index.html";
		}
		
		/* New for FileUpload, CKEditor */
		ClassicEditor
			.create( document.querySelector( '#divEditorInsert' ) ) // .create( $('#divEditorInsert')[0] )
			.then( editor => {
				CKEditorInsert = editor;
		    } )
			.catch( err => {
		    	console.error( err.stack );
			} );
	
		ClassicEditor
			.create( document.querySelector( '#divEditorUpdate' ) ) // .create( $('#divEditorUpdate')[0] )
			.then( editor => {
				CKEditorUpdate = editor;
		    } )
			.catch( err => {
		    	console.error( err.stack );
			} );
		
		/* / New for FileUpload, CKEditor */
		
		boardList();
		
		// ë§ˆì´ í˜ì´ì§€
		document.querySelector("#mypage").onclick = function(){
      		
      		var myModal = new bootstrap.Modal(document.getElementById("userinfo"));
      		document.querySelector("#userNameDetail").innerHTML = sessionStorage.getItem("userName");
      		document.querySelector("#userEmailDetail").innerHTML = sessionStorage.getItem("userEmail");
      		
      		var regDt = sessionStorage.getItem("userRegisterDate");
      		//var regDtStr = makeDateStr(regDt.date.year, regDt.date.month, regDt.date.day, '.');
      		document.querySelector("#userRegiDetail").innerHTML = regDt;
      		
            myModal.show();
		}
		
		// ê²€ìƒ‰ì–´ ê²€ìƒ‰ 
		document.querySelector("#btnSearchWord").onclick = function(){
			SEARCH_WORD = document.querySelector("#inputSearchWord").value;
			// ì²˜ìŒ í˜ì´ì§€ë¡œ ì´ˆê¸°í™”
			OFFSET = 0;
			CURRENT_PAGE_INDEX = 1;
			
			boardList();
		}
		
		// ê¸€ ë“±ë¡
		document.querySelector("#btnInsert").onclick = function(){
			document.querySelector("#titleInsert").value = "";
			CKEditorInsert.setData("")
			
			// New for FileUpload
			document.querySelector("#chkFileUploadInsert").checked = false;
			document.querySelector("#inputFileUploadInsert").value = "";
			document.querySelector("#imgFileUploadInsertThumbnail").innerHTML = "";
			document.querySelector("#imgFileUploadInsertWrapper").style.display = "none";
			// bootstrap 5 show modal
			let modal = new bootstrap.Modal(document.querySelector("#boardInsertModal"), {  keyboard: false } )
			modal.show();
		}
		
		// insert
		document.querySelector("#btnBoardInsert").onclick = function(){
			
			if( validateInsert() ){
				boardInsert();
			}
		};
		
		// New for FileUpload
		// insert file upload change
		document.querySelector("#chkFileUploadInsert").onchange = function(){
			if( this.checked ){
				document.querySelector("#imgFileUploadInsertWrapper").style.display = "block";
			}else{
				document.querySelector("#inputFileUploadInsert").value = "";
				document.querySelector("#imgFileUploadInsertThumbnail").innerHTML = "";
				document.querySelector("#imgFileUploadInsertWrapper").style.display = "none";
			}
		};
		
		// New for FileUpload
		// insert file upload change image load
		document.querySelector("#inputFileUploadInsert").onchange = function(e){
	
			if( this.files && this.files.length > 0 ){
	
				for( var i=0; i<this.files.length; i++ ){
					
					var reader = new FileReader();
					reader.readAsDataURL(this.files[i]);
					reader.onload = function(e){
						let thumbnailHTML = `<img src="${e.target.result}">`;
						document.querySelector("#imgFileUploadInsertThumbnail").insertAdjacentHTML('beforeend', thumbnailHTML);
					}
				}
			}	
		}
		
		// update
		document.querySelector("#btnBoardUpdateForm").onclick = function(){
			
			var boardId = document.querySelector("#boardDetailModal").getAttribute("data-boardId");
			document.querySelector("#boardUpdateModal").setAttribute("data-boardId", boardId);
			
			document.querySelector("#titleUpdate").value = document.querySelector("#titleDetail").innerHTML;
			
			// changes CKEditor
			// $("#contentUpdate").val( $("#contentDetail").html() );
			CKEditorUpdate.setData( document.querySelector("#contentDetail").innerHTML );
			
			let fileListHTML = ``;
			document.querySelectorAll("#fileListDetail .fileName").forEach( el => {
				fileListHTML += `<div class="fileName">${el.innerHTML}</div>`;
			})
			
			document.querySelector("#fileListUpdate").innerHTML = fileListHTML;
	
			document.querySelector("#chkFileUploadUpdate").checked = false;
			document.querySelector("#inputFileUploadUpdate").value = "";
			document.querySelector("#imgFileUploadInsertThumbnail").innerHTML = "";
			document.querySelector("#imgFileUploadUpdateWrapper").style.display = "none";
	
			// bootstrap 5 show modal
			let detailModal = new bootstrap.Modal(document.querySelector("#boardDetailModal"), {  keyboard: false } )
			detailModal.hide();
			let updateModal = new bootstrap.Modal(document.querySelector("#boardUpdateModal"), {  keyboard: false } )
			updateModal.show();
		};
	
		// update
		document.querySelector("#btnBoardUpdate").onclick = function(){
			
			if( validateUpdate() ){
				boardUpdate();
			}
		};
		
		// New for FileUpload
		// update file upload change image load
		document.querySelector("#chkFileUploadUpdate").onchange = function(){
			if( this.checked ){
				document.querySelector("#imgFileUploadUpdateWrapper").style.display = "block";
			}else{
				document.querySelector("#inputFileUploadUpdate").value = "";
				document.querySelector("#imgFileUploadUpdateThumbnail").innerHTML = "";
				document.querySelector("#imgFileUploadUpdateWrapper").style.display = "none";
			}
		};
	
		// New for FileUpload
		// update file upload change image load
		document.querySelector("#inputFileUploadUpdate").onchange = function(e){
	
			if( this.files && this.files.length > 0 ){
				
				for( var i=0; i<this.files.length; i++ ){
	
					var reader = new FileReader();
					reader.readAsDataURL(this.files[i]);
					reader.onload = function(e){
						let thumbnailHTML = `<img src="${e.target.result}">`;
						document.querySelector("#imgFileUploadUpdateThumbnail").insertAdjacentHTML('beforeend', thumbnailHTML);
					}
				}
			}	
		}
		
		document.querySelector("#modify").onclick = function(){
      		window.location.href="/modify";
		}
	
		
	/* 	$("#inputFileUploadUpdate").change(function(e){
	
			if( this.files && this.files.length > 0 ){
				
				for( var i=0; i<this.files.length; i++ ){
	
					var reader = new FileReader();
					reader.readAsDataURL(this.files[i]);
					reader.onload = function(e){
						$("#imgFileUploadUpdateThumbnail").append('<img src="' + e.target.result +'">'); // e.target : reader
					}
				}
			}
		}); */
		
		// delete
		document.querySelector("#btnBoardDeleteConfirm").onclick = function(){
			 alertify.confirm('ì‚­ì œ í™•ì¸', 'ì´ ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
	 			function() {
					boardDelete();
	 			},
				function(){
	 				console.log('cancel');
				}
			);
		};
	}


	// list
	function boardList(){
	    
		let fetchOptions = {
	      	headers: {
	    	  'async': 'true'
	      	},
	    }
		
		var url = '/boards';
	  	var urlParams = `?limit=${LIST_ROW_COUNT}&offset=${OFFSET}&searchWord=${SEARCH_WORD}`;
	
	    
	    fetch(url + urlParams, fetchOptions)
	    	.then( response => response.json())
	    	.then( json => {
	    		if( json.result == "login" ){
	    			window.location.href="/login";
	    		}else if( json.result == SUCCESS ){
	    			makeListHtml(json.list);
	    		   	TOTAL_LIST_ITEM_COUNT = json.count;
	    		   	addPagination();
	    		}else{
	    			alertify.error('ê¸€ ì¡°íšŒ ê³¼ì •ì— ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.');
	    		}
	    	})
	    	.catch( error => {
	    		console.error( error );
	    		alertify.error('ê¸€ ì¡°íšŒ ê³¼ì •ì— ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.');
	    	});
	}
	
	function makeListHtml(list){
		console.log(list);
		
		let listHTML = ``;
		
		list.forEach( el => {
			let boardId = el.boardId;
			let userName = el.userName;
			let title = el.title;
			let content = el.content;
			let regDt = el.regDt;	// javascript of parsed from LocalDateTime
			// for Jackson Format Of LocalDateTime
			// var regDtStr = regDt;		
			// for Gson Format Of LocalDateTime
			let regDtStr = makeDateStr(regDt.date.year, regDt.date.month, regDt.date.day, '.'); 
			let readCount = el.readCount;
			
			listHTML += `<tr style="cursor:pointer" data-boardId=${boardId}><td>${boardId}</td><td>${title}</td><td>${userName}</td><td>${regDtStr}</td><td>${readCount}</td></tr>`;
		});
		
	
		document.querySelector("#boardTbody").innerHTML = listHTML
	
		makeListHtmlEventHandler();
	
		//boardListTotalCnt(); <== removed
	}
	
	function makeListHtmlEventHandler(){
		document.querySelectorAll("#boardTbody tr").forEach( el => {
			el.onclick = function(){
				var boardId = this.getAttribute("data-boardId");
				boardDetail(boardId);
			}
		});
	}
	
	
	
	// list total
	// function boardListTotalCnt(){} <== removed
	
	
	function addPagination(){
	
		makePaginationHtml(LIST_ROW_COUNT, PAGE_LINK_COUNT, CURRENT_PAGE_INDEX, TOTAL_LIST_ITEM_COUNT, "paginationWrapper" );
	}
	
	function movePage(pageIndex){
		OFFSET = (pageIndex - 1) * LIST_ROW_COUNT;
		CURRENT_PAGE_INDEX = pageIndex;
		boardList();
	}
	
	
	
	function validateInsert(){
		var isTitleInsertValid = false;
		var isContentInsertValid = false;
	
		var titleInsert = document.querySelector("#titleInsert").value;
		var titleInsertLength = titleInsert.length;
		
		if( titleInsertLength > 0 ){
			isTitleInsertValid = true;
		}
		
		// changes CKEditor
		// var contentInsertValue = $("#contentInsert").val();
		var contentInsertValue = CKEditorInsert.getData();
		
		var contentInsertLength = contentInsertValue.length;
		
		if( contentInsertLength > 0 ){
			isContentInsertValid = true;
		}
	
		if(	isTitleInsertValid && isContentInsertValid ){
			return true;
		}else{
			return false;
		}
	}
	
	// insert
	// headers ì— content-type ì„ multipart/form-data ë¡œ ì£¼ë©´ boundary ë¥¼ ì°¾ì§€ ëª»í•˜ëŠ” ì˜¤ë¥˜ ë°œìƒ (mdn ë¬¸ì„œì™€ ë‹¤ë¥¸ë‹¤.)
	function boardInsert(){
	
		var formData = new FormData();
	
		formData.append("title", document.querySelector("#titleInsert").value);
		formData.append("content", CKEditorInsert.getData());	
		// file upload
		var cnt = document.querySelector("#inputFileUploadInsert").files.length;
		for (var i = 0; i < cnt; i++) {
			formData.append("file", document.querySelector("#inputFileUploadInsert").files[i]);
		}
		
		let fetchOptions = {
	      	method: 'POST',
	      	headers: {
	    	  'async': 'true'
	      	},
	      	body: formData
	    }
	
	    fetch('/boards', fetchOptions)
	    	.then( response => response.json())
	    	.then( json => {
	    		if( json.result == "login" ){
	    			window.location.href="/login";
	    		}else if( json.result == SUCCESS ){
	    			alertify.success('ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
	        		boardList();
	    		}else{
	    			alertify.error('ê¸€ ë“±ë¡ ê³¼ì •ì— ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.');
	    		}
	    	})
	       .catch( error => {
	    		console.error( error );
	    		alertify.error('ê¸€ ë“±ë¡ ê³¼ì •ì— ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.');
	    	});
	}
	
	// detail
	// No userSeq In Client Code <-- userSeq In Server Using HttpSession
	function boardDetail(boardId){
	
		let fetchOptions = {
	      	headers: {
	    	  'async': 'true'
	      	},
	    }
		
		var url = '/boards/' + boardId;
	    
	    fetch(url, fetchOptions)
	    	.then( response => response.json())
	    	.then( json => {
	    		if( json.result == "login" ){
	    			window.location.href="/login";
	    		}else if( json.result == SUCCESS ){
	    			makeDetailHtml(json.dto);
	    		}else{
	    			alertify.error('ê¸€ ìƒì„¸ ì¡°íšŒ ê³¼ì •ì— ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.');
	    		}
	    	})
	    	.catch( error => {
	    		console.error( error );
	    		alertify.error('ê¸€ ìƒì„¸ ì¡°íšŒ ê³¼ì •ì— ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.');
	    	});
	}
	
	function makeDetailHtml(detail){
	
		var boardId = detail.boardId;
		var userSeq = detail.userSeq;
		var userName = detail.userName;
		var title = detail.title;
		var content = detail.content;
		var regDt = detail.regDt;
	console.log(regDt)
		var regDtStr = makeDateStr(regDt.date.year, regDt.date.month, regDt.date.day, '.') + ' ' + makeTimeStr(regDt.time.hour, regDt.time.minute, regDt.time.second, ':'); // for Gson Format Of LocalDateTime
		//regDtStr = regDt; // refactorig later
		
		
		var readCount = detail.readCount;
		var sameUser = detail.sameUser;
		
		var fileList = detail.fileList;
		
		document.querySelector("#boardDetailModal").setAttribute("data-boardId", boardId);
		document.querySelector("#boardIdDetail").innerHTML = "#" + boardId;
		document.querySelector("#titleDetail").innerHTML = title;
		document.querySelector("#contentDetail").innerHTML = content;
		document.querySelector("#userNameDetail").innerHTML = userName;
		document.querySelector("#regDtDetail").innerHTML = regDtStr;
		document.querySelector("#readCountDetail").innerHTML = readCount;
		
		//FileList
		document.querySelector("#fileListDetail").innerHTML = "";
		
		var fileListDetailHtml = '';
		if( fileList.length > 0 ){
			for(var i=0; i<fileList.length; i++){
				var fileId = fileList[i].fileId;
				var fileName = fileList[i].fileName;
				var fileUrl = fileList[i].fileUrl;
	
				fileListDetailHtml += 
					`
					<div>
						<span class="fileName">${fileName}</span>
						&nbsp;&nbsp;
						<a type="button" class="btn btn-outline btn-default btn-xs" data-fileId="${fileId}" href="${fileUrl}" download="${fileName}">ë‚´ë ¤ë°›ê¸°</a>	
					</div>
					`;
			}
			
			document.querySelector("#fileListDetail").innerHTML = fileListDetailHtml;
		}
		
	
		if( sameUser ){
			document.querySelector("#btnBoardUpdateForm").style.display = "inline-block";
			document.querySelector("#btnBoardDeleteConfirm").style.display = "inline-block";
		}else{
			document.querySelector("#btnBoardUpdateForm").style.display = "none";
			document.querySelector("#btnBoardDeleteConfirm").style.display = "none";
		}
		
	
		// bootstrap 5 show modal
		let modal = new bootstrap.Modal(document.querySelector("#boardDetailModal"), {  keyboard: false } )
		modal.show();
	}
	
	// update
	function validateUpdate(){
		var isTitleUpdateValid = false;
		var isContentUpdateValid = false;
	
		var titleUpdate = document.querySelector("#titleUpdate").value;
		var titleUpdateLength = titleUpdate.length;
		
		if( titleUpdateLength > 0 ){
			isTitleUpdateValid = true;
		}
		
		// changes CKEditor
		// var contentUpdateValue = $("#contentUpdate").val();
		var contentUpdateValue = CKEditorUpdate.getData();
		
		var contentUpdateLength = contentUpdateValue.length;
		
		if( contentUpdateLength > 0 ){
			isContentUpdateValid = true;
		}
	
		if(	isTitleUpdateValid && isContentUpdateValid ){
			return true;
		}else{
			return false;
		}
	}
	
	// headers ì— content-type ì„ multipart/form-data ë¡œ ì£¼ë©´ boundary ë¥¼ ì°¾ì§€ ëª»í•˜ëŠ” ì˜¤ë¥˜ ë°œìƒ (mdn ë¬¸ì„œì™€ ë‹¤ë¥¸ë‹¤.)
	function boardUpdate(){
		
		var boardId = document.querySelector("#boardUpdateModal").getAttribute("data-boardId");
		var formData = new FormData();
		// formData.append("_method", "PUT");
		formData.append("boardId", boardId);
	
		formData.append("title", document.querySelector("#titleUpdate").value);
		formData.append("content", CKEditorUpdate.getData());
		
		// file upload
		var cnt = document.querySelector("#inputFileUploadUpdate").files.length;
		for (var i = 0; i < cnt; i++) {
			formData.append("file", document.querySelector("#inputFileUploadUpdate").files[i]);
		}
	
		var url = '/boards/' + boardId;
		
		let fetchOptions = {
	      	method: 'POST',
	      	headers: {
	    	  'async': 'true'
	      	},
	      	body: formData
	    }
		
	    fetch(url, fetchOptions)
			.then( response => response.json())
			.then( json => {
				if( json.result == "login" ){
					window.location.href="/login";
				}else if( json.result == SUCCESS ){
					alertify.success('ê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
		    		boardList();
				}else{
					alertify.error('ê¸€ ìˆ˜ì • ê³¼ì •ì— ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.');
				}
			})
		   .catch( error => {
				console.error( error );
				alertify.error('ê¸€ ìˆ˜ì • ê³¼ì •ì— ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.');
			});
	}
	
	// delete
	function boardDelete(){
		
		var boardId = document.querySelector("#boardDetailModal").getAttribute("data-boardId");
		var url = '/boards/' + boardId;
	
		let fetchOptions = {
	      	method: 'DELETE',
	      	headers: {
	    	  'async': 'true'
	      	},
	    }
		
		fetch(url, fetchOptions)
			.then( response => response.json())
			.then( json => {
				if( json.result == "login" ){
					window.location.href="/login";
				}else if( json.result == SUCCESS ){
					alertify.success('ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
		    		boardList();
				}else{
					alertify.error('ê¸€ ì‚­ì œ ê³¼ì •ì— ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.');
				}
			})
		   .catch( error => {
				console.error( error );
				alertify.error('ê¸€ ì‚­ì œ ê³¼ì •ì— ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.');
			});
	
	}
</script>

</body>
</html>