<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
	<!-- Bootstrap 5 ë²„ì „ -->
	<!-- https://getbootstrap.com/docs/5.0/getting-started/introduction/ -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
	
	<!-- No jQuery -->

	<script src="//cdn.jsdelivr.net/npm/alertifyjs@1.12.0/build/alertify.min.js"></script>
	<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.12.0/build/css/alertify.min.css"/>
	<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.12.0/build/css/themes/default.min.css"/>
	
	<!-- New for FileUpload, CKEditor -->
	<link rel="stylesheet" href="/css/common.css">
	<script src="https://cdn.ckeditor.com/ckeditor5/19.0.0/classic/ckeditor.js"></script>
	<!-- / New for FileUpload, CKEditor -->
    
    <title> ë¶€ë™ì‚° ê±°ë˜ ëª©ë¡ ì¡°íšŒ í™”ë©´</title>
    
	<style>
	    
	    div.left {
	        width: 45%;
	        float: left;
	        box-sizing: border-box;
	        
	    }
	    div.right {
	        width: 45%;
	        float: right;
	        box-sizing: border-box;
	        margin-left: 1px
	    }
    </style>


<script
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB1CRjAOA93vwh8VvCkgR1AGt2VGiclFws&callback=initMap&libraries=&v=weekly"
async
defer
></script>
<script>
    var map;
    function initMap() {
        map = new google.maps.Map(
            document.getElementById("map"),
            {
                center: {
                    lat:37.5843639,
                    lng: 126.9681153
                },
                zoom : 8
            }
        );
    }

    var markers = [];
    var indices = [];
   

</script>
     
</head>

<body>
	 <!-- #1 navbar  -->
	<div class="container" style="margin-bottom: 100px">
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
				<div class="container-fluid">
					<a class="navbar-brand" href="/index_AfterLogin">Happy
						House</a>
					<button class="navbar-toggler" type="button"
						data-bs-toggle="collapse" data-bs-target="#navbarNav"
						aria-controls="navbarNav" aria-expanded="false"
						aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarNav">
						<ul class="navbar-nav">
							<li class="nav-item"><a class="nav-link active"
								aria-current="page" href="/noticelist">ê³µì§€ì‚¬í•­</a></li>
							<li class="nav-item"><a class="nav-link" href="/board">ê²Œì‹œíŒ</a></li>
							<li class="nav-item"><a class="nav-link" href="/Building_Search"> ì•„íŒŒíŠ¸ ë§¤ë§¤ ì •ë³´</a></li>
							
							
						</ul>
					</div>
					<div class="collapse navbar-collapse justify-content-end"
						id="navbarNav">
						<ul class="navbar-nav">
							<li class="nav-item"><a class="nav-link" id="logout">ğŸ”’ë¡œê·¸ì•„ì›ƒ</a>
							</li>
							<li class="nav-item"><a class="nav-link" id="mypage">âœ‹ë‚´ì •ë³´</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>
		</div>
	<!-- #1 navbar  -->

	<div class="container"> <!-- #2 ì»¨í…Œì´ë„ˆ í”Œë£¨ì´ë“œ -->
		<!-- ë‚¨ì•„ìˆëŠ”ê±´ ì»¨í…Œì´ë„ˆ / ì»¨í…Œì´ë„ˆ í”Œë£¨ì´ë“œëŠ” 100í”„ë¡œë¡œ ì–‘ì˜†ì— ì±„ì›Œì¤Œ -->
		<div class="my-3 d-flex justify-content-center">
			<h4> ë¶€ë™ì‚° ê±°ë˜ ëª©ë¡ ì¡°íšŒ   </h4>
		</div>
		
		<div class="left">
		<div class="input-group mb-3">
		  <input id="inputSearchWord" type="text" class="form-control" placeholder="ë™ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰" aria-label="Recipient's username" aria-describedby="button-addon2">
		  <button class="btn btn-outline-success" type="button" id="btnSearchWord"> ì°¾ê¸° </button>
		</div>
		<table class="table table-hover">
			  <thead>
			    <tr>
			      <th>#</th>
			      <th> ë™ </th>
			      <th> ì•„íŒŒíŠ¸ ì´ë¦„  </th>
			      <th> ì•„íŒŒíŠ¸ ê±°ë˜ê°€ </th>
			      <th> í¬ê¸° </th>
			    </tr>
			  </thead> <!--  í—¤ë“œ  -->
			  <tbody id="boardTbody">
			    <!-- ë™ì ìœ¼ë¡œ ê°”ë‹¤ì™€ì„œ ì±„ìš¸ ë‚´ìš©  -->
			    
			  </tbody>
			  
		</table>
		<div id="paginationWrapper">   </div>
		</div> <!-- ì™¼ìª½ ê²Œì‹œíŒ  -->
		
		<!--           ë§µ              -->
		<div class="right">
		 <div id="map" style="width:100%; height: 500px;"></div>
		</div>
	<!-- ë²„íŠ¼ ì¶”ê°€
	<button class="btn btn-primary" type="button" id="btnInsert"> ê¸€ì“°ê¸° </button>
	  -->
	  
  	</div> <!-- #2 ì»¨í…Œì´ë„ˆ -->
	
	
	
<!-- Modal detail-->

<div class="modal" tabindex="-1" id="boardDetailModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"> ë§¤ë¬¼ ìƒì„¸</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

    <table class="table table-hover">
      <tbody>
        <tr><td> ë§¤ë¬¼ ë²ˆí˜¸ </td><td id="nodetail">#</td></tr>
        <tr><td> êµ¬ </td><td id="gudetail">#</td></tr>
        <tr><td> ë™ </td><td id="dongdetail">#</td></tr>
        <tr><td> ì•„íŒŒíŠ¸ ì´ë¦„ </td><td id="aptnamedetail">#</td></tr>
        <tr><td> ë„“ì´ </td><td id="areadetail">#</td></tr>
        <tr><td> ì¸µìˆ˜ </td><td id="floordetail">#</td></tr>
        <tr><td> ì™„ê³µë‚ ì§œ </td><td id="buildyeardetail">#</td></tr>
        <tr><td> ë§¤ë§¤ê°€  </td><td id="dealamount">#</td></tr>
        <tr><td> ë§¤ë§¤ë…„ë„ </td><td id="dealyear">#</td></tr>
        
	</tbody>
    </table>
    
  </div>   
  <button id="showlocation" class="btn btn-sm btn-primary btn-outline" data-bs-dismiss="modal" type="button"> ì§€ë„ì—ì„œ ë³´ê¸° </button>
				
</div>
   
  </div>
</div>
<!-- End Modal -->
<!--------------- Modal --------------------------->
		<div class="modal fade" id="userinfo">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<!-- Modal Header -->
					<div class="modal-header">
						<h4 class="modal-title">ë‚´ì •ë³´ ë³´ê¸°</h4>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>

					<div class="modal-body">

						<div class="example table-responsive">
							<table class="table">
								<tbody>
									
									<tr>
										<td> ìœ ì € ì´ë¦„ </td>
										<td id="userNameDetail">#</td>
									</tr>
									<tr>
										<td> ìœ ì € ì´ë©”ì¼ </td>
										<td id="userEmailDetail">#</td>
									</tr>
									<tr>
										<td> ê°€ì…ë‚ ì§œ </td>
										<td id="userRegiDetail">#</td>
									</tr>
																		
								</tbody>
							</table>
						</div>
						
						<div class="container">
						  <div class="row">
						    <div class="col-9">
						    </div>
						    <div class="col-3">
						     <button id="modify" type="button" class="btn btn-warning">íšŒì›ì •ë³´ ìˆ˜ì •í•˜ê¸°</button>
						   
						    </div>
						  </div>
						</div>

					</div>
					
					
					
				</div>
			</div>
		</div>
		<!--------------- Modal --------------------------->
<!-------------------------- JavaScript ----------------------->
<script src="/js/util.js"></script>	
<script>
		// ì „ì—­ë³€ìˆ˜ ì„ ì–¸
		var LIST_ROW_COUNT = 10; // ê²Œì‹œê¸€ ëª‡ê°œë¥¼ ë³´ì—¬ì¤„ê²ƒì¸ì§€ // limitì˜ ì˜ë¯¸ì´ë‹¤.
		var OFFSET = 0; // 
		var SEARCH_WORD = ""; 
		var map;
		var CKEditorInsert;
		var CKEditorUpdate;
		
		
		var PAGE_LINK_COUNT = 10;	// pagination link ê°¯ìˆ˜
		var TOTAL_LIST_ITEM_COUNT = 0;
		var CURRENT_PAGE_INDEX = 1;
		
		
		const SUCCESS = 1;
		
		
		
		window.onload = function(){
			
			// ë¡œê·¸ì¸ì´ ì•ˆë˜ì–´ìˆìœ¼ë©´ ì´ˆê¸°ê°’ìœ¼ë¡œ // ì´ê±´ ë‹¤ ë¶™ì—¬ì£¼ê¸° jsì— ì €ì¥í• ìˆ˜ë„ ìˆìŒ.
			if ( sessionStorage.length == 0 || sessionStorage == null ) {
				alert("ë¡œê·¸ì¸ í•˜ì„¸ìš”!");
				window.location.href="/";
			}
			// íšŒì› ì •ë³´
	      	console.log(sessionStorage);
			
			document.querySelector("#logout").onclick = function(){
				alert("ë¡œê·¸ì•„ì›ƒí•©ë‹ˆë‹¤!");
				sessionStorage.clear();
				window.location.href="/index.html";
			}
			boardList();
			
			// ê²€ìƒ‰ì–´ ê²€ìƒ‰ 
			document.querySelector("#btnSearchWord").onclick = function(){
				SEARCH_WORD = document.querySelector("#inputSearchWord").value;
				// ì²˜ìŒ í˜ì´ì§€ë¡œ ì´ˆê¸°í™”
				OFFSET = 0;
				CURRENT_PAGE_INDEX = 1;
				console.log(SEARCH_WORD + "ë¡œ ì°¾ê¸°")
				boardList();
			}
			
			// ë§ˆì´ í˜ì´ì§€
			document.querySelector("#mypage").onclick = function(){
	      		
	      		var myModal = new bootstrap.Modal(document.getElementById("userinfo"));
	      		document.querySelector("#userNameDetail").innerHTML = sessionStorage.getItem("userName");
	      		document.querySelector("#userEmailDetail").innerHTML = sessionStorage.getItem("userEmail");
	      		
	      		var regDt = sessionStorage.getItem("userRegisterDate");
	      		//var regDtStr = makeDateStr(regDt.date.year, regDt.date.month, regDt.date.day, '.');
	      		document.querySelector("#userRegiDetail").innerHTML = regDt;
	      		
	            myModal.show();
			}
			
			document.querySelector("#modify").onclick = function(){
	      		window.location.href="/modify";
			}
		
		} // onload ë


		// list
		function boardList(){
			let fetchOptions = {
		      	headers: {
		    	  'async': 'true'
		      	},
		    }
			
			var url = '/building';
		  	var urlParams = `?limit=${LIST_ROW_COUNT}&offset=${OFFSET}&searchWord=${SEARCH_WORD}`;
		
		    
		    fetch(url + urlParams, fetchOptions)
		    	.then( response => response.json())
		    	.then( json => {
		    		if( json.result == "login" ){
		    			window.location.href="/";
		    		}else if( json.result == SUCCESS ){
		    			makeListHtml(json.list);
		    		   	TOTAL_LIST_ITEM_COUNT = json.count;
		    		   	addPagination();
		    		}else{
		    			alertify.error('ê¸€ ì¡°íšŒ ê³¼ì •ì— ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.');
		    		}
		    	})
		    	.catch( error => {
		    		console.error( error );
		    		alertify.error('ê¸€ ì¡°íšŒ ê³¼ì •ì— ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.');
		    	});
		}
		
		function makeListHtml(list){
			console.log(list);
			let listHTML = ``;
			list.forEach( el => {
				let no = el.no;
				let dong = el.dong;
				var Aptname = el.AptName;
				let	dealAmount = el.dealAmount;
				let area = el.area;
				
				listHTML += `<tr style="cursor:pointer" data-boardId=${no}> <td> ${no} </td> <td>${dong}</td>  <td>${Aptname}</td><td>${dealAmount}</td><td>${area}</td></tr>`;
			});
			document.querySelector("#boardTbody").innerHTML = listHTML
			makeListHtmlEventHandler();
			//boardListTotalCnt(); <== removed
		}
		
		function makeListHtmlEventHandler(){
			document.querySelectorAll("#boardTbody tr").forEach( el => {
				el.onclick = function(){
					var boardId = this.getAttribute("data-boardId");
					boardDetail(boardId); // ìƒì„¸í´ë¦­í•˜ê¸° 
				}
			});
		}
		// list total
		// function boardListTotalCnt(){} <== removed
		
		function addPagination(){
		
			makePaginationHtml(LIST_ROW_COUNT, PAGE_LINK_COUNT, CURRENT_PAGE_INDEX, TOTAL_LIST_ITEM_COUNT, "paginationWrapper" );
		}
		
		function movePage(pageIndex){
			OFFSET = (pageIndex - 1) * LIST_ROW_COUNT;
			CURRENT_PAGE_INDEX = pageIndex;
			boardList();
		}
		
		// ìƒì„¸ë³´ê¸° 
		function boardDetail(boardId){
			let fetchOptions = {
		      	headers: {
		    	  'async': 'true'
		      	}
		    }
			
			var url = '/building/' + boardId;
		    
		    fetch(url, fetchOptions)
		    	.then( response => response.json())
		    	.then( json => {
		    		if( json.result == SUCCESS ){
		    			makeDetailHtml(json.dto);
		    		}else{
		    			alertify.error('ê¸€ ìƒì„¸ ì¡°íšŒ ê³¼ì •ì— ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.');
		    		}
		    	})
		    	.catch( error => {
		    		console.error( error );
		    		alertify.error('ê¸€ ìƒì„¸ ì¡°íšŒ ê³¼ì •ì— ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.');
		    	});
		}
		
		function makeDetailHtml(el){
			console.log("ìƒì„¸ë³´ê¸°");
			console.log(el);
			
			
			let no = el.no;
		    let guname = el.gugunName;
		    let dong = el.dong;
		    let Aptname = el.AptName;
			let	dealAmount = el.dealAmount;
			let dealYear = el.dealYear
			let area = el.area;
			let floor = el.floor;
			let	buildYear = el.buildYear;
			
			document.querySelector("#nodetail").setAttribute("data-boardId", no);
			document.querySelector("#nodetail").innerHTML = "#" + no;
			document.querySelector("#gudetail").innerHTML = guname;
			document.querySelector("#dongdetail").innerHTML = Aptname;
			document.querySelector("#aptnamedetail").innerHTML = dealAmount;
			document.querySelector("#areadetail").innerHTML = dealAmount;
			document.querySelector("#floordetail").innerHTML = dealYear;
			document.querySelector("#buildyeardetail").innerHTML = area;
			document.querySelector("#dealamount").innerHTML = floor;
			document.querySelector("#dealyear").innerHTML = buildYear;
			/// ë²„íŠ¼ í´ë¦­ì‹œ ì§€ë„ì— ì¢Œí‘œ ë„ìš°ê¸°
			document.querySelector("#showlocation").onclick = function(){
				// ìœ„ë„ ê²½ë„ ë„ìš°ê¸° 
				let lat2 = el.lat;
				let lng2 = el.lng;
				//console.log("ìœ„ë„ê²½ë„")
				//console.log(lat2);
				//console.log(lng2);
				//$("#lat").html(lat2);
				//$("#lng").html(lng2);
				var ttt = { lat: lat2 ,lng: lng2 };
				console.log(ttt);
				map = new google.maps.Map(
			  	        document.getElementById('map'), {
			  	          zoom: 15,
			  	          center: ttt
			  	        });
				var marker = new google.maps.Marker( { position: ttt, map:map});
			}
			
			// ëª¨ë‹¬ì°½ ë„ìš°ê¸°
			let modal = new bootstrap.Modal(document.querySelector("#boardDetailModal"), {  keyboard: false } )
			modal.show();
		}
		
		
			
   </script>
   <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB1CRjAOA93vwh8VvCkgR1AGt2VGiclFws&callback=initMap&libraries=&v=weekly"
	></script>
  
  	<script>
  	// ë§µê´€ë ¨ ë©”ì†Œë“œ
  	 function initMap() {
  	      var seoul = { lat: 37.5642135 ,lng: 127.0016985 };
  	      map = new google.maps.Map(
  	        document.getElementById('map'), {
  	          zoom: 12,
  	          center: seoul
  	        });
  	      
  	      var marker = new google.maps.Marker( { 
  	    	  position: seoul,
  	    	  map:map
  	    	 });
  	      
  	    }
  	
  	</script>
   
   
</body>
</html>